---
title: "Football Modelling Project"
output: html_notebook
---

For this project, we will look at how to predict football matches. It won't be an extensive model,
but it should be good enough as a starting betting model. We will use the English
Premier League data



#### Let us begin by adding the necessary libraries needed .


```{r, include=TRUE}
library(devtools)
library(engsoccerdata)
library(tidyverse)
set.seed(2021)
```

##### Loading English Premier League data from the engsoccerdata and filtering the relevant season out.
```{r}
main_data<- engsoccerdata::england %>%
  filter(Season>1991)%>%
  select(Season,home, away= visitor, hgoal, agoal= vgoal,totgoal,result) 

```

##### Let us have a sneek peak into our data
```{r, include=TRUE}
head(main_data)

```

##### To begin modeling, let us visualize our data. Let us look at the number of goals scored in a football match. It is important to note that, goals can be scored at any time during a football match. That randomness is very important during the modeling stage.

```{r, include=TRUE}
hist(main_data$totgoal, col= 'green', xlab = 'Goals', main= 'Frequency of both home and away goals',
     ylab= 'No of matches',xlim = c(0,10))

```


#####  There is a hypothesis that teams final result are influenced based on whether they play at home or away. Thus, it is imperative we look at the goal distribution between home and away teams. 

```{r, include=TRUE}
par(mfrow=c(1,2),
  mar=c(4,4,1,0))

hist(main_data$hgoal , col=rgb(1,0,0,0.5) ,xlim = c(0,7), xlab="Goals" , ylab="No. of matches" , main="Frequency of home goals" )

hist(main_data$agoal, breaks=30  , xlim = c(0,7),col=rgb(0,0,1,0.5) , xlab="Goals" , ylab="" , main="Frequency of away goals")
```

###### We observe home teams seem to score more goals in comparison with away teams. Thus,that should influence our modelling decisions.

#### Modelling
##### In comparison with other sports like basketball, soccer is a low scoring sport. Goals are also scored randomly at any point in time. The ability of a team to score should thus depend on the strength of the team offensively and defensive abiliities of the opponent. We will use the Poisson distribution as a base model. We will generate poisson distributions with the means as average home and away goals scored and see how well they could fit our data

```{r, include=FALSE}


#Generating random poisson variables for the home matches
home_poisson= rpois(100000, mean(main_data$hgoal))
data_home_poisson= data.frame(home_poisson)

#Generating random poisson variables for the away matches
away_poisson= rpois(100000, mean(main_data$agoal))
data_away_poisson= data.frame(away_poisson)
```

```{r}
ggplot(main_data, aes(hgoal)) +
  #density
  geom_density(adjust = 8, alpha = 0.5, fill= 'red') +
  labs(title = "Poisson fit to home goals",
       x = "goals", y = "density") + geom_density(data = data_home_poisson, aes(x = home_poisson),fill = NA, adjust = 8, alpha = 0.2) 
```
```{r}
ggplot(main_data, aes(agoal)) +
  #density
  geom_density(adjust = 8, alpha = 0.5, fill= 'blue') +
  labs(title = "Poisson fit to away goals",
       x = "goals scored", y = "density") + geom_density(data =data_away_poisson, aes(x = away_poisson),fill = NA, adjust = 8, alpha = 0.2) 
```

##### We observe both are not bad fits to the data at all and the poisson distribution could be a good starting model to fit the data. It is important to note that, we haven't made any statistical tests to validate the claim the data is actually poisson distributed. the eye test just shows that it isn't a bad choice. Now, we need to estimate the strenght of a team offensively, its opponents defensive abilities and whether they are playing at home or away. Before we do that, let us check whether there was indeed a home advantage for teams during the pandemic. Recall that, during the pandemic, there were no fans in the stadium and there were some really interesting results during that period.




